+++
title = """
  Тренировки DevOps от Yandex. Лекция 1: "Кто такой DevOps-инженер"
  """
date = 2023-11-01T00:00:00+03:00
lastmod = 2023-11-02
tags = ["DevOps"]
draft = false
+++

В этой серии постов я буду фиксировать свой опыт решения задач по [Тренировкам по DevOps](https://yandex.ru/yaintern/training/devops-training) от Yandex.

[Ссылка на расписание лекций](https://yandex.ru/yaintern/training/devops-training)

[Ссылка на трансляцию](https://youtube.com/live/mMEeidcHpoY)


## Домашнее задание {#домашнее-задание}

Первое домашнее задание не подразумевает единственно правильного решения, так что ниже отражён мой личный опыт и размышления, не претендующие на абсолютную истину. Кроме решений задачек, они точно рабочие на момент написания поста.


### 1. Решить 10 простых задачек с [LeetCode](http://leetcode.com) {#1-dot-решить-10-простых-задачек-с-leetcode}

Я уже ранее решал задачи на [HackerRank](https://www.hackerrank.com/) при подготовке к собеседованиям, так что в целом процесс мне знаком.
Здесь всё относительно просто: залогинился на LeetCode через GitHub аккаунт и выбрал задачи со сложностью Easy по разным темам: две по Algorithms, четыре по Database, четыре по Shell. Сами задачки выбирались рандомно.


#### [1287. Element Appearing More Than 25% In Sorted Array](https://leetcode.com/problems/element-appearing-more-than-25-in-sorted-array/) {#1287-dot-element-appearing-more-than-25-in-sorted-array}

Моё решение довольно простое без всяких [list comprehensions](https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions), но это и лучше для читаемости. Решение на Python3.

```python
class Solution:
    def findSpecialInteger(self, arr: List[int]) -> int:
        threshold =  len(arr) * .25
        counter = {}

        for number in arr:
            counter.setdefault(n, 0)
            counter[number] += 1

        for number, count in counter.items():
            if count > threshold:
                return number
```


#### [1619. Mean of Array After Removing Some Elements](https://leetcode.com/problems/mean-of-array-after-removing-some-elements/) {#1619-dot-mean-of-array-after-removing-some-elements}

Тупанул, упустив условие что нужно не просто обрезать 5% по краям массива, а обрезать 5% самых малых и самых больших чисел. То есть сначала необходимо отсортировать входной массив. Решение на Python3.

```python
class Solution:
    def trimMean(self, arr: List[int]) -> float:
        arr.sort()
        cut = len(arr) // 20
        trimmedArr = arr[cut:len(arr)-cut]
        return sum(trimmedArr) / len(trimmedArr)
```


#### [1050. Actors and Directors Who Cooperated At Least Three Times](https://leetcode.com/problems/actors-and-directors-who-cooperated-at-least-three-times/) {#1050-dot-actors-and-directors-who-cooperated-at-least-three-times}

Решение для [PostgreSQL]({{< relref "20230621213418-postgresql.md" >}}).

```sql
SELECT actor_id, director_id
FROM ActorDirector
GROUP BY actor_id, director_id
HAVING COUNT(*) >= 3;
```


#### [182. Duplicate Emails](https://leetcode.com/problems/duplicate-emails/) {#182-dot-duplicate-emails}

Решение для [PostgreSQL]({{< relref "20230621213418-postgresql.md" >}}).

```sql
SELECT email
FROM Person
GROUP BY email
HAVING count(*) > 1
```


#### [607. Sales Person](https://leetcode.com/problems/sales-person/) {#607-dot-sales-person}

Решение для [PostgreSQL]({{< relref "20230621213418-postgresql.md" >}}).

```sql
-- Используем CTE чтобы найти имена продавцов, которые
-- работали с компанией "RED".
WITH excluded AS (
  SELECT DISTINCT sp.name
  FROM Orders o
  LEFT JOIN Company c ON c.com_id = o.com_id
  LEFT JOIN SalesPerson sp ON sp.sales_id = o.sales_id
  WHERE c.name = 'RED'
)
-- Выбираем продавцов, исключая работавших с "RED"
SELECT DISTINCT sp.name
FROM SalesPerson sp
WHERE sp.name NOT IN (SELECT * FROM excluded)
```


#### [2356. Number of Unique Subjects Taught by Each Teacher](https://leetcode.com/problems/number-of-unique-subjects-taught-by-each-teacher/) {#2356-dot-number-of-unique-subjects-taught-by-each-teacher}

Решение для MySQL.

```sql
SELECT teacher_id, COUNT(DISTINCT subject_id) AS cnt
FROM Teacher
GROUP BY teacher_id;
```


#### [195. Tenth Line](https://leetcode.com/problems/tenth-line/) {#195-dot-tenth-line}

После нескольких вариантов, самым простым показался вариант с использованием [sed]({{< relref "20231101115738-sed.md" >}}).

```bash
sed -n "10p" "file.txt" || echo ""
```


#### [193. Valid Phone Numbers](https://leetcode.com/problems/valid-phone-numbers/) {#193-dot-valid-phone-numbers}

Эту задачу решил с применением [grep]({{< relref "20231101121729-grep.md" >}}).

```bash
grep -Po '(^\d{3}-|^\(\d{3}\)\s{1})\d{3}-\d{4}$' file.txt
```


#### [194. Transpose File](https://leetcode.com/problems/transpose-file/) {#194-dot-transpose-file}

Эта задача со сложностью Medium.
Наиболее удобным решением было бы использовать [awk]({{< relref "20231101120118-awk.md" >}}). Можно решить задачу и другими способами, даже на чистом шелле, но так действительно проще.

```bash
awk '{
    for (i=1; i<=NF; i++) {
        if (NR == 1) {
            result[i] = $i;
        } else {
            result[i] = result[i] " " $i;
        }
    }
} END {
    for (i=1; i<=NF; i++) {
        print result[i];
    }
}' file.txt
```


#### [192. Word Frequency](https://leetcode.com/problems/word-frequency/) {#192-dot-word-frequency}

Эта задача со сложностью Medium.
Её также можно было бы решить на [awk]({{< relref "20231101120118-awk.md" >}}), но я попытался собрать конвеер из стандартных утилит. [sed]({{< relref "20231101115738-sed.md" >}}) в конце используется для того чтобы поменять местами частоту и слово, поскольку `uniq -c` ставит число перед словом, а по условию задачи требуется сначала вывести число, а затем частоту с которым оно встречается.

```bash
tr -s ' ' '\n' < words.txt | sort | uniq -c | sort -k1,1nr -k2,2 | sed -E 's/^[[:space:]]*([[:digit:]]+) (.+)/\2 \1/'
```


### 2. Базовые консольные команды {#2-dot-базовые-консольные-команды}

В терминале открыть bash, в нём выполнить команду `ls -l`. Ваша задача разобраться с тем как работает [sed]({{< relref "20231101115738-sed.md" >}}) и с его помощью добавить по пробелу в начало каждой строки вывода `ls -l`. Например, из `drwxr-xr-x …` должно получиться `_drwxr-xr-x …` (с пробелом в начале). Задача "со звёздочкой" — сделать то же самое с помощью [awk]({{< relref "20231101120118-awk.md" >}}).


#### Решение {#решение}

По-сути бонусная задачка на умение работать в консоли.

Минимальная версия с использованием [sed]({{< relref "20231101115738-sed.md" >}}):

```bash
ls -l | sed -E 's/^/ /'
```

Версия с использованием [awk]({{< relref "20231101120118-awk.md" >}}) не намного сложнее:

```bash
ls -l | awk '{print " "$0}'
```


### 3. Почитать в интернете про аппаратные возможности современных серверов. {#3-dot-почитать-в-интернете-про-аппаратные-возможности-современных-серверов-dot}

Цель задачи — понимать масштабы современного оборудования.
Практически все вопросы спорные, если не сказать провокационные и быстрый ответ на любой из них — "it depends".


#### Какого размера актуальные диски HDD/NVMe/SSD? {#какого-размера-актуальные-диски-hdd-nvme-ssd}

Ответ на вопрос зависит от того что считать "актуальным", кто собирает статистику и каким способом. Даже онлайн относительно среднего объёма одного диска встречается оценка вида 1-8 Тб в среднем и около 22 Тб максимально для одного носителя. Есть модели и с большим объёмом, но они пока ещё больше диковина, а не обыденность. В любом случае объём единственного носителя не так критичен, поскольку чаще всего диски объединены в массивы.


#### Сколько ядер CPU, оперативной памяти сейчас в топовом сервере? {#сколько-ядер-cpu-оперативной-памяти-сейчас-в-топовом-сервере}

Важно помнить что оценивать какие-то технические параметры сервера по-отдельности это глупо, как оценивать фотокамеры по количеству мегапикселей примерно. Сервер это сложная система, при выборе которой нужно учитывать и множество технических факторов, и экономическую эффективность, и даже перспективы поддержки производителем. Онлайн поиск навёл на [такую статью](https://www.serverwatch.com/hardware/top-rack-servers/), согласно которой большинство самых мощных серверов поддерживает до 8 терабайт оперативной памяти и имеет два сокета для процессоров Intel Xeon Scalable, имеющих до 32 ядер на процессор, то есть максимально 64 физических ядра на единственный сервер. Процессоры AMD Epyc могут иметь ещё больше ядер, до 128, что в двухсокетной системе даст 256 ядер.


#### Кто сейчас впереди, Intel или AMD? {#кто-сейчас-впереди-intel-или-amd}

Впереди чего именно? Если рассматривать долю рынка, то однозначно всё ещё Intel, хотя доля AMD постепенно растёт. Если рассматривать технические особенности, то в целом считается что AMD предлагает лучшее соотношение цена-производительность-тепловыделение чем Intel. Также существует мнение что процессоры Intel имеют больше производительности на одиночное ядро, а процессоры AMD лучше в своей многоядерности.


#### Сколько и каких видеокарт можно установить в сервер? {#сколько-и-каких-видеокарт-можно-установить-в-сервер}

Специализированные серверы могут вмещать до 16 GPU
![](./img/multi-gpu-system.webp)
Сами серверные видеокарты в общем-то отличаются от потребительских использованием ECC памяти и зачастую не имеют видеовыхода, так что поставить их в игровой пека не получится.


#### Какую максимальную скорость сети можно получить на сервере? {#какую-максимальную-скорость-сети-можно-получить-на-сервере}

Тоже довольно интересный, хоть и расплывчатый вопрос.

Можем считать что "на сервере" это только подключением к loopback интерфейсу, тогда даже на ноуте, на котором я набираю этот текст, при тестировании через iperf3 скорость может быть до 35.7 **Гигабит**.

Если же говорить про внешние соединения, здесь тоже полно вариантов. Существует технология link aggregation для объединения нескольких сетевых интерфейсов в один виртуальный. Но важно понимать что при этом увеличивается общая пропускная способность, но отдельные соединения физически всё равно идут через отдельные интерфейсы и ограничены их скоростью. Это можно представить как многополосное шоссе — если добавить ещё полос, общая пропускная способность увеличится, но ограничение по скорости на полосу останется тем же. Из технологий, применяемых на практике — адаптеры Infiniband GDR могут поддерживать эффективную скорость 400 Гбит/c на один линк с возможностью аггрегации до 12 линков.


### 4. Установка [Minikube]({{< relref "20230530171940-minikube.md" >}}) {#4-dot-установка-minikube--20230530171940-minikube-dot-md}

Запустить локально на своём ПК, или в виртуальной машине Minikube (либо аналог)

-   Найти в интернете тестовый deployment — поискать в Яндексе "как установить minikube"
-   Выполнить найденные инструкции, получив работоспособную систему
-   Проверить работоспособность с помощью консольной утилиты `curl` или в браузере

Здесь мне проще, поскольку я уже [установил Minikube]({{< relref "minikube_installation.md" >}}) на свой сервер, настроил управление с ноутбука и даже захостил [простенький сервис](https://github.com/vsokhranov/bumbleboard). Так что можно считать что это задание я уже выполнил.


### 5. Посмотреть на роадмапы на [roadmap.sh](https://roadmap.sh) {#5-dot-посмотреть-на-роадмапы-на-roadmap-dot-sh}

Найти темы, которые вам нужно подтянуть или в которые стоит углубиться. Из этих тем найти одну или две первоочередные. Запланировать изучение:)

Этот ресурс мне давно знаком, здесь я периодически ищу подсказки в каком направлении обучения двигаться дальше. Разумеется, основной план, который я использую это [DevOps](https://roadmap.sh/devops), но также изучаю [Kubernetes](https://roadmap.sh/kubernetes), а сейчас нашёл для себя новый интересный план — [PostgreSQL DBA](https://roadmap.sh/postgresql-dba).
