+++
title = "Поиск медианы в MySQL"
date = 2023-07-29T00:00:00+03:00
lastmod = 2023-08-10
tags = ["snippets", "MySQL", "SQL"]
draft = false
+++

Иногда требуется найти медианное значение в таблице. В отличие от среднего, медиана это значение, разделяющее диапазон на две равные части. В случае равномерного распределения, медиана совпадает со средним арифметическим, но в других случаях может и отличаться. Если диапазон содержит чётное количество значений, медианное приходится на среднее между двумя центральными значениями.

Рассмотрим пример поиска медианного значения северной широты (`LAT_N`) из таблицы метеостанций.

```sql
SET @row_index := -1;

SELECT ROUND(AVG(subq.LAT_N),4)
FROM (
    SELECT @row_index:=@row_index + 1 AS row_index, LAT_N
    FROM STATION
    ORDER BY LAT_N
  ) AS subq
  WHERE subq.row_index
  IN (FLOOR(@row_index / 2) , CEIL(@row_index / 2));
```

Разберём этот запрос подробнее.

```sql
SET @row_index := -1;
```

Эта строка создаёт переменную `@row_index` со значением -1.

```sql
(
    SELECT @row_index:=@row_index + 1 AS row_index, LAT_N
    FROM STATION
    ORDER BY LAT_N
  ) AS subq
```

Здесь мы запрашиваем целевую колонку `LAT_N` из таблицы `STATION`, отсортированную по возрастанию значения `LAT_N` и назначаем каждому столбцу порядковый номер, начиная с 0.

```sql
WHERE subq.row_index
IN (FLOOR(@row_index / 2) , CEIL(@row_index / 2));
```

Это условие позволяет выбрать среднюю строку.
