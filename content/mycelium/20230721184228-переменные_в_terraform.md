+++
title = "Переменные в Terraform"
lastmod = 2023-07-21
tags = ["Terraform"]
draft = false
+++

## Для чего используются переменные (input variables) в Terraform? {#для-чего-используются-переменные--input-variables--в-terraform}

Для того же, для чего и в программировании — для обращения по имени к какому-либо значению.


## Типы переменных, поддерживаемые в Terraform? {#типы-переменных-поддерживаемые-в-terraform}

-   string
-   number
-   bool
-   list(&lt;TYPE&gt;)
-   set(&lt;TYPE&gt;)
-   map(&lt;TYPE&gt;)
-   object({&lt;ATTR_NAME&gt; = &lt;TYPE&gt;, ... })
-   tuple([&lt;TYPE&gt;, ...])


## Какой тип переменной используется по-умолчанию? {#какой-тип-переменной-используется-по-умолчанию}

`any`


## Способы передать значения для переменных? {#способы-передать-значения-для-переменных}

-   С использованием опции `-var` в командной строке.
-   С использованием файла переменных и опции `-var-file`.
-   Через переменные окружения, которые начинаются с `TF_VAR_<VAR_NAME>`

Если не значение не было передано, оно будет запрошено в процессе выполнения команды.


## Как сослаться на переменную? {#как-сослаться-на-переменную}

С использованием синтакса `var.<VAR_NAME>`


## Какой смысл отмечать переменные как "sensitive"? {#какой-смысл-отмечать-переменные-как-sensitive}

Значение таких переменных не отображается в логах выполнения команд `terraform apply` и `terraform plan`, но всё равно попадает в файл состояния. Если результат выражения зависит от значения такой переменной, он тоже становится "чувствительным".


## Что такое выходные переменные (output variables)? {#что-такое-выходные-переменные--output-variables}

Выходные переменные позволяют выводить определённые значения в процессе исполнения команд Terraform. Наверное самый распространённый пример использования таких переменных это вывод IP адреса создаваемого инстанса сразу после его создания.


## Пример определения переменной с указанием типа и дефолтными параметрами {#пример-определения-переменной-с-указанием-типа-и-дефолтными-параметрами}

```hcl
variable "app_id" {
  type = string
  description = "The id of application"
  default = "some_value"
}
```

Примечание: обычно переменные определяются в отдельном файле, например `vars.tf`


## Как определить переменную-объект с несколькими разными аттрибутами? {#как-определить-переменную-объект-с-несколькими-разными-аттрибутами}

```hcl
variable "car_model" {
  description = "Car model object"
  type        = object({
    model   = string
    color   = string
    year    = number
  })
}
```


## Пример обращения к переменной {#пример-обращения-к-переменной}

В файле `vars.tf`

```hcl
variable "memory" {
  type = string
  default "8192"
}

variable "cpu" {
  type = string
  default = "4"
}
```

В файле `main.tf`

```hcl
resource "libvirt_domain" "vm1" {
   name = "vm1"
   memory = var.memory
   cpu = var.cpu
}
```


## Что такое локали (locals)? {#что-такое-локали--locals}

Локали это аналог констант в программировании: их значение задаётся один раз и не может быть изменено пользователем.


## Пример определения локали {#пример-определения-локали}

```hcl
locals {
  x = 2
  y = "o"
  z = 2.2
}
```


## Пример использования локали {#пример-использования-локали}

Аналогично использованию переменных, но с ключевым словом local вместо var, например `local.x`
