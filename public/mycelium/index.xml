<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Цифровой мицелий</title>
        <link>https://weirdvic.github.io/mycelium/</link>
        <description>Recent content on Цифровой мицелий</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>ru-ru</language>
        <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc/4.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CC BY-NC 4.0&lt;/a&gt;</copyright>
        <lastBuildDate>Wed, 19 Jul 2023 00:00:00 +0000</lastBuildDate>
        <atom:link href="https://weirdvic.github.io/mycelium/index.xml" rel="self" type="application/rss+xml" />
        
        <item>
            <title>10 самых больших таблиц в базе</title>
            <link>https://weirdvic.github.io/mycelium/10-%D1%81%D0%B0%D0%BC%D1%8B%D1%85-%D0%B1%D0%BE%D0%BB%D1%8C%D1%88%D0%B8%D1%85-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86-%D0%B2-%D0%B1%D0%B0%D0%B7%D0%B5/</link>
            <pubDate>Mon, 31 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/10-%D1%81%D0%B0%D0%BC%D1%8B%D1%85-%D0%B1%D0%BE%D0%BB%D1%8C%D1%88%D0%B8%D1%85-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86-%D0%B2-%D0%B1%D0%B0%D0%B7%D0%B5/</guid>
            <description>Запрос позволяет найти 10(или больше) самых больших таблиц PostgreSQL по занимаемому месту на диске:
SELECT schemaname AS &amp;#34;table_schema&amp;#34;, relname AS &amp;#34;table_name&amp;#34;, pg_size_pretty(pg_total_relation_size(relid)) AS total_size, pg_size_pretty(pg_relation_size(relid)) AS data_size, pg_size_pretty(pg_total_relation_size(relid) - pg_relation_size(relid)) AS external_size FROM pg_catalog.pg_statio_user_tables ORDER BY pg_total_relation_size(relid) DESC, pg_relation_size(relid) DESC LIMIT 10; </description>
            <content type="html"><![CDATA[<p>Запрос позволяет найти 10(или больше) самых больших таблиц PostgreSQL по занимаемому месту на диске:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>    schemaname <span style="color:#66d9ef">AS</span> <span style="color:#e6db74">&#34;table_schema&#34;</span>,
</span></span><span style="display:flex;"><span>    relname <span style="color:#66d9ef">AS</span> <span style="color:#e6db74">&#34;table_name&#34;</span>,
</span></span><span style="display:flex;"><span>    pg_size_pretty(pg_total_relation_size(relid)) <span style="color:#66d9ef">AS</span> total_size,
</span></span><span style="display:flex;"><span>    pg_size_pretty(pg_relation_size(relid)) <span style="color:#66d9ef">AS</span> data_size,
</span></span><span style="display:flex;"><span>    pg_size_pretty(pg_total_relation_size(relid) <span style="color:#f92672">-</span> pg_relation_size(relid))
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">AS</span> external_size
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span>
</span></span><span style="display:flex;"><span>    pg_catalog.pg_statio_user_tables
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span>
</span></span><span style="display:flex;"><span>    pg_total_relation_size(relid) <span style="color:#66d9ef">DESC</span>,
</span></span><span style="display:flex;"><span>         pg_relation_size(relid) <span style="color:#66d9ef">DESC</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">10</span>;
</span></span></code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Infrastructure as Code</title>
            <link>https://weirdvic.github.io/mycelium/infrastructure-as-code/</link>
            <pubDate>Sat, 29 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/infrastructure-as-code/</guid>
            <description>Infrastructure-as-Code или IaC это автоматизированный подход к описанию и управлению IT инфраструктурой не через ручное редактирование файлов конфигураций на серверах, а с применением специальных инструментов. Инструменты IaC являются важной частью практик DevOps и концепций CI/CD.
Под инфраструктурой в данном случае понимается совокупность аппаратных и программных компонентов, составляющих IT среду, таких как серверы, устройства хранения данных, сетевые устройства и т.д.
Основная идея IaC в том чтобы перенести практики, применяющиеся в разработке ПО на управление инфраструктурой.</description>
            <content type="html"><![CDATA[<p>Infrastructure-as-Code или IaC это автоматизированный подход к описанию и управлению IT инфраструктурой не через ручное редактирование файлов конфигураций на серверах, а с применением специальных инструментов. Инструменты IaC являются важной частью практик <a href="/mycelium/devops/">DevOps</a> и концепций CI/CD.</p>
<p>Под инфраструктурой в данном случае понимается совокупность аппаратных и программных компонентов, составляющих IT среду, таких как серверы, устройства хранения данных, сетевые устройства и т.д.</p>
<p>Основная идея IaC в том чтобы перенести практики, применяющиеся в разработке ПО на управление инфраструктурой. Сам код для управления инфраструктурой может быть написан как в декларативном стиле, так и в императивном. При декларативном подходе описывается желаемое состояние системы (в идеале), а необходимые действия для достижения этого состояния производит инструмент управления конфигурацией. Ну а при императивном подходе мы указываем что конкретно нужно сделать.</p>
<p>Также между разными инструментами существует различие в методе инициации обновления. Различают push метод это когда изменения конфигурации приходят с некоего управляющего хоста на управляемые и pull метод, когда управляемые хосты по-расписанию или при других условиях сами запрашивают обновление конфигурации у управляющего хоста.</p>
<p>К наиболее распространённым в практике инструментам IaC относятся:</p>
<ul>
<li><a href="/mycelium/terraform/">Terraform</a></li>
<li>Cloudformation</li>
<li><a href="/mycelium/ansible/">Ansible</a></li>
<li>SaltStack</li>
<li>Puppet</li>
</ul>
<p>Инструменты, использующие IaC подход можно разделить на две большие группы:</p>
<ol>
<li>Инструменты для развёртывания(provisioning) инфраструктуры, такие как Terraform и Cloudformation</li>
<li>Инструменты для конфигурации инфраструктуры как Ansible, Puppet, Chef</li>
</ol>
<p>Provisioning инфраструктуры это процесс создания компонентов инфраструктуры и предоставления доступа конечным пользователям.</p>
<p>Важной характеристикой IaC инструментов является <a href="/mycelium/%D0%B8%D0%B4%D0%B5%D0%BC%D0%BF%D0%BE%D1%82%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D1%8C/">идемпотентность</a>.</p>
]]></content>
        </item>
        
        <item>
            <title>Поиск медианы в MySQL</title>
            <link>https://weirdvic.github.io/mycelium/%D0%BF%D0%BE%D0%B8%D1%81%D0%BA-%D0%BC%D0%B5%D0%B4%D0%B8%D0%B0%D0%BD%D1%8B-%D0%B2-mysql/</link>
            <pubDate>Sat, 29 Jul 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%BF%D0%BE%D0%B8%D1%81%D0%BA-%D0%BC%D0%B5%D0%B4%D0%B8%D0%B0%D0%BD%D1%8B-%D0%B2-mysql/</guid>
            <description>Иногда требуется найти медианное значение в таблице. В отличие от среднего, медиана это значение, разделяющее диапазон на две равные части. В случае равномерного распределения, медиана совпадает со средним арифметическим, но в других случаях может и отличаться. Если диапазон содержит чётное количество значений, медианное приходится на среднее между двумя центральными значениями.
Рассмотрим пример поиска медианного значения северной широты (LAT_N) из таблицы метеостанций.
SET @row_index := -1; SELECT ROUND(AVG(subq.LAT_N),4) FROM ( SELECT @row_index:=@row_index + 1 AS row_index, LAT_N FROM STATION ORDER BY LAT_N ) AS subq WHERE subq.</description>
            <content type="html"><![CDATA[<p>Иногда требуется найти медианное значение в таблице. В отличие от среднего, медиана это значение, разделяющее диапазон на две равные части. В случае равномерного распределения, медиана совпадает со средним арифметическим, но в других случаях может и отличаться. Если диапазон содержит чётное количество значений, медианное приходится на среднее между двумя центральными значениями.</p>
<p>Рассмотрим пример поиска медианного значения северной широты (LAT_N) из таблицы метеостанций.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SET</span> <span style="color:#f92672">@</span>row_index :<span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> ROUND(<span style="color:#66d9ef">AVG</span>(subq.LAT_N),<span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">@</span>row_index:<span style="color:#f92672">=@</span>row_index <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">AS</span> row_index, LAT_N
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">FROM</span> STATION
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> LAT_N
</span></span><span style="display:flex;"><span>  ) <span style="color:#66d9ef">AS</span> subq
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">WHERE</span> subq.row_index
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">IN</span> (FLOOR(<span style="color:#f92672">@</span>row_index <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) , CEIL(<span style="color:#f92672">@</span>row_index <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>));
</span></span></code></pre></div><p>Разберём этот запрос подробнее.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SET</span> <span style="color:#f92672">@</span>row_index :<span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span></code></pre></div><p>Эта строка создаёт переменную <code>@row_index</code> со значением -1.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">@</span>row_index:<span style="color:#f92672">=@</span>row_index <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">AS</span> row_index, LAT_N
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">FROM</span> STATION
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> LAT_N
</span></span><span style="display:flex;"><span>  ) <span style="color:#66d9ef">AS</span> subq
</span></span></code></pre></div><p>Здесь мы запрашиваем целевую колонку <code>LAT_N</code> из таблицы <code>STATION</code>, отсортированную по возрастанию значения <code>LAT_N</code> и назначаем каждому столбцу порядковый номер, начиная с 0.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> subq.row_index
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">IN</span> (FLOOR(<span style="color:#f92672">@</span>row_index <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) , CEIL(<span style="color:#f92672">@</span>row_index <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>));
</span></span></code></pre></div><p>Это условие позволяет выбрать среднюю строку.</p>
]]></content>
        </item>
        
        <item>
            <title>DevOps</title>
            <link>https://weirdvic.github.io/mycelium/devops/</link>
            <pubDate>Fri, 28 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/devops/</guid>
            <description>Что такое DevOps? По этому поводу есть много споров и существует много различных определений DevOps, приведу примеры от разных компаний
Amazon DevOps это сочетание культурной философии, практик и инструментов, увеличивающее способность организации доставлять приложения и сервисы быстрее: изменять и улучшать продукты быстрее чем организации, использующие традиционный подход к разработке ПО и управлению инфраструктурой. Эта скорость позволяет организациям лучше удовлетворять потребности клиентов и быть более эффективными.
Microsoft DevOps это союз людей, процессов и продуктов ради обеспечения непрерывной доставки конечным пользователям.</description>
            <content type="html"><![CDATA[<h2 id="что-такое-devops">Что такое DevOps?</h2>
<p>По этому поводу есть много споров и существует много различных определений DevOps, приведу примеры от разных компаний</p>
<h3 id="amazon">Amazon</h3>
<p>DevOps это сочетание культурной философии, практик и инструментов, увеличивающее способность организации доставлять приложения и сервисы быстрее: изменять и улучшать продукты быстрее чем организации, использующие традиционный подход к разработке ПО и управлению инфраструктурой. Эта скорость позволяет организациям лучше удовлетворять потребности клиентов и быть более эффективными.</p>
<h3 id="microsoft">Microsoft</h3>
<p>DevOps это союз людей, процессов и продуктов ради обеспечения непрерывной доставки конечным пользователям.&ldquo;Dev&rdquo; и &ldquo;Ops&rdquo; относится к переходу от отдельных команд разработки и эксплуатации к командам, работающим с использованием общих практик и инструментов. Важнейшими DevOps практиками являются agile планированиеб непрерывная интеграция, непрерывная доставка и мониторинг приложений.</p>
<h3 id="red-hat">Red Hat</h3>
<p>DevOps описывает подход к ускорению процессов перехода от идеи(например новой функции в ПО, багфикса или улучшения) к разработке и внедрению и достижению конечного пользователя. Этот подход требует частой коммуникации команд разработки и эксплуатации и отношения к работе с эмпатией к своим коллегам. Кроме того приветствуется масштабируемость решений и простой запуск.</p>
]]></content>
        </item>
        
        <item>
            <title>Идемпотентность</title>
            <link>https://weirdvic.github.io/mycelium/%D0%B8%D0%B4%D0%B5%D0%BC%D0%BF%D0%BE%D1%82%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D1%8C/</link>
            <pubDate>Fri, 28 Jul 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%B8%D0%B4%D0%B5%D0%BC%D0%BF%D0%BE%D1%82%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D1%8C/</guid>
            <description>Идемпотентность(idempotency) — свойство объекта или операции при повторном применении операции к объекту давать тот же результат, что и при первом.
В контексте IT это характеристика инструментов, которые не вносят дополнительные изменения в систему при перезапусках. Например плейбук Ansible, который создал файлы в системе при первом запуске, при повторном и следующих запусках не должен пытаться снова создать эти файлы если они уже существуют в системе.</description>
            <content type="html"><![CDATA[<p>Идемпотентность(idempotency) — свойство объекта или операции при повторном применении операции к объекту давать тот же результат, что и при первом.</p>
<p>В контексте IT это характеристика инструментов, которые не вносят дополнительные изменения в систему при перезапусках.
Например плейбук <a href="/mycelium/ansible/">Ansible</a>, который создал файлы в системе при первом запуске, при повторном и следующих запусках не должен пытаться снова создать эти файлы если они уже существуют в системе.</p>
]]></content>
        </item>
        
        <item>
            <title>Ошибка suspiciously many broken parts to remove</title>
            <link>https://weirdvic.github.io/mycelium/%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0-suspiciously-many-broken-parts-to-remove/</link>
            <pubDate>Wed, 26 Jul 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0-suspiciously-many-broken-parts-to-remove/</guid>
            <description>При запуске сервера Clickhouse после аварийной перезагрузки или проблем с файловой системой может появиться большое число ошибок и сервер просто не запустится. В логах Clickhouse ошибки будут примерно такие:
2023.07.26 19:26:36.621640 [ 2366 ] {} &amp;lt;Error&amp;gt; Application: DB::Exception: Suspiciously many (29) broken parts to remove.: Cannot attach table anyclass.event from metadata file /var/lib/clickhouse/store/430/430da485-c4de-4665-830d-a485c4de4665/event.sql from query ATTACH TABLE … clickhouse from path /var/lib/clickhouse/metadata/clickhouse В таком случае может помочь создание файла /var/lib/clickhouse/flags/force_restore_data и перезапуск сервера:</description>
            <content type="html"><![CDATA[<p>При запуске сервера <a href="/mycelium/clickhouse/">Clickhouse</a> после аварийной перезагрузки или проблем с файловой системой может появиться большое число ошибок и сервер просто не запустится. В логах Clickhouse ошибки будут примерно такие:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-org" data-lang="org"><span style="display:flex;"><span>2023.07.26 19:26:36.621640 [ 2366 ] {} &lt;<span style="color:#e6db74">Error</span>&gt; Application: DB::Exception: Suspiciously many (29) broken parts to remove.: Cannot attach table anyclass.event from metadata file /var/lib/clickhouse/store/430/430da485-c4de-4665-830d-a485c4de4665/event.sql from query ATTACH TABLE … clickhouse from path /var/lib/clickhouse/metadata/clickhouse
</span></span></code></pre></div><p>В таком случае может помочь создание файла <code>/var/lib/clickhouse/flags/force_restore_data</code> и перезапуск сервера:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u clickhouse touch /var/lib/clickhouse/flags/force_restore_data
</span></span><span style="display:flex;"><span>sudo systemctl restart clickhouse-server
</span></span></code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Модули Terraform</title>
            <link>https://weirdvic.github.io/mycelium/%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D0%B8-terraform/</link>
            <pubDate>Sun, 23 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D0%B8-terraform/</guid>
            <description>Определение модулей Terraform Модуль представляет собой контейнер для нескольких ресурсов, используемых совместно. Модули могут быть использованы для построения абстракций над базовыми &amp;ldquo;строительными блоками&amp;rdquo; для описания архитектуры на более высоком уровне.
Как определить модуль Terraform? Фактически любые файлы Terraform в одной директории составляют модуль. Нет специального синтаксиса для определения модулей.
Как тестировать модули Terraform? Есть несколько различных способов, один из них — использование инструмента terratest для проверки инициализации модуля, создания и удаления ресурсов.</description>
            <content type="html"><![CDATA[<h2 id="определение-модулей-terraform">Определение модулей Terraform</h2>
<p>Модуль представляет собой контейнер для нескольких ресурсов, используемых совместно. Модули могут быть использованы для построения абстракций над базовыми &ldquo;строительными блоками&rdquo; для описания архитектуры на более высоком уровне.</p>
<h2 id="как-определить-модуль-terraform">Как определить модуль Terraform?</h2>
<p>Фактически любые файлы Terraform в одной директории составляют модуль. Нет специального синтаксиса для определения модулей.</p>
<h2 id="как-тестировать-модули-terraform">Как тестировать модули Terraform?</h2>
<p>Есть несколько различных способов, один из них — использование инструмента <code>terratest</code> для проверки инициализации модуля, создания и удаления ресурсов.</p>
]]></content>
        </item>
        
        <item>
            <title>Типичный рабочий процесс с Terraform</title>
            <link>https://weirdvic.github.io/mycelium/%D1%82%D0%B8%D0%BF%D0%B8%D1%87%D0%BD%D1%8B%D0%B9-%D1%80%D0%B0%D0%B1%D0%BE%D1%87%D0%B8%D0%B9-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81-%D1%81-terraform/</link>
            <pubDate>Sun, 23 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D1%82%D0%B8%D0%BF%D0%B8%D1%87%D0%BD%D1%8B%D0%B9-%D1%80%D0%B0%D0%B1%D0%BE%D1%87%D0%B8%D0%B9-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81-%D1%81-terraform/</guid>
            <description>Terraform
Написание определений в файлах .tf на языке HCL и запуск команды terraform init (только в первый раз для установки необходимых провайдеров). Проверка планируемых изменений с помощью команды terraform plan. Применение изменений командой terraform apply. </description>
            <content type="html"><![CDATA[<p>Terraform</p>
<ol>
<li>Написание определений в файлах <code>.tf</code> на языке HCL и запуск команды <code>terraform init</code> (только в первый раз для установки необходимых <a href="/mycelium/%D0%BF%D1%80%D0%BE%D0%B2%D0%B0%D0%B9%D0%B4%D0%B5%D1%80%D1%8B-terraform/">провайдеров</a>).</li>
<li>Проверка планируемых изменений с помощью команды <code>terraform plan</code>.</li>
<li>Применение изменений командой <code>terraform apply</code>.</li>
</ol>
]]></content>
        </item>
        
        <item>
            <title>Data sources в Terraform</title>
            <link>https://weirdvic.github.io/mycelium/data-sources-%D0%B2-terraform/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/data-sources-%D0%B2-terraform/</guid>
            <description>Источники данных используются для получения данных от провайдеров или, в общем смысле, от любых внешних ресурсов (например публичных облаков AWS, GCP и др.) Источники данных только предоставляют данные, ничего не создают и не изменяют.
Пример использования источников данных в Terraform data &amp;#34;aws_vpc&amp;#34; &amp;#34;default { default = true } Обращение к данным внутри источника Допустим источник данных определён таким способом:
data &amp;#34;aws_vpc&amp;#34; &amp;#34;default { default = true } Тогда для обращения к его аттрибуту ID можно использовать такой способ: data.</description>
            <content type="html"><![CDATA[<p>Источники данных используются для получения данных от <a href="/mycelium/%D0%BF%D1%80%D0%BE%D0%B2%D0%B0%D0%B9%D0%B4%D0%B5%D1%80%D1%8B-terraform/">провайдеров</a> или, в общем смысле, от любых внешних ресурсов (например публичных облаков AWS, <a href="/mycelium/google-cloud-platform/">GCP</a> и др.)
Источники данных только предоставляют данные, ничего не создают и не изменяют.</p>
<h2 id="пример-использования-источников-данных-в-terraform">Пример использования источников данных в Terraform</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">data</span> <span style="color:#e6db74">&#34;aws_vpc&#34; &#34;</span><span style="color:#66d9ef">default</span> {
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="обращение-к-данным-внутри-источника">Обращение к данным внутри источника</h2>
<p>Допустим источник данных определён таким способом:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">data</span> <span style="color:#e6db74">&#34;aws_vpc&#34; &#34;</span><span style="color:#66d9ef">default</span> {
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Тогда для обращения к его аттрибуту ID можно использовать такой способ: <code>data.aws_vpc.default.id</code></p>
<h2 id="комбинирование-источников-данных">Комбинирование источников данных</h2>
<p>Например мы хотим получить подсети в AWS, но находящиеся только в дефолтной VPC:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">data</span> <span style="color:#e6db74">&#34;aws_subnets&#34; &#34;default&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">filter</span> {
</span></span><span style="display:flex;"><span>    name   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vpc-id&#34;</span>
</span></span><span style="display:flex;"><span>    values <span style="color:#f92672">=</span> [<span style="color:#66d9ef">data</span>.<span style="color:#66d9ef">aws_vpc</span>.<span style="color:#66d9ef">default</span>.<span style="color:#66d9ef">id</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Мы используем второй источник данных в качестве фильтра.</p>
]]></content>
        </item>
        
        <item>
            <title>Workspaces в Terraform</title>
            <link>https://weirdvic.github.io/mycelium/workspaces-%D0%B2-terraform/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/workspaces-%D0%B2-terraform/</guid>
            <description>Определение рабочего пространства из официальной документации довольно расплывчатое. Условно рабочим пространством можно назвать постоянные данные и cостояние(state) для определённого бэкенда. Каждое рабочее пространство обладает собственным файлом состояния. Использовать рабочие пространства для разделения между разными окружениями(например development и production) плохая идея потому что рабочие пространства хранятся в одном месте и к ним применяются одинаковые ограничения доступа. Плюс легко ошибиться и выполнить команду в неправильном пространстве.
Как создать новое рабочее пространство? terraform workspace new &amp;lt;WORKSPACE_NAME&amp;gt;</description>
            <content type="html"><![CDATA[<p>Определение рабочего пространства из <a href="https://developer.hashicorp.com/terraform/language/state/workspaces">официальной документации</a> довольно расплывчатое. Условно рабочим пространством можно назвать постоянные данные и <a href="/mycelium/%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5-%D0%B2-terrafrom/">cостояние(state)</a> для определённого бэкенда. Каждое рабочее пространство обладает собственным файлом состояния. Использовать рабочие пространства для разделения между разными окружениями(например development и production) плохая идея потому что рабочие пространства хранятся в одном месте и к ним применяются одинаковые ограничения доступа. Плюс легко ошибиться и выполнить команду в неправильном пространстве.</p>
<h2 id="как-создать-новое-рабочее-пространство">Как создать новое рабочее пространство?</h2>
<p><code>terraform workspace new &lt;WORKSPACE_NAME&gt;</code></p>
<h2 id="как-определить-текущее-рабочее-пространство">Как определить текущее рабочее пространство?</h2>
<p><code>terraform workspace show</code></p>
]]></content>
        </item>
        
        <item>
            <title>Жизненный цикл ресурсов в Terraform</title>
            <link>https://weirdvic.github.io/mycelium/%D0%B6%D0%B8%D0%B7%D0%BD%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%86%D0%B8%D0%BA%D0%BB-%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%BE%D0%B2-%D0%B2-terraform/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%B6%D0%B8%D0%B7%D0%BD%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%86%D0%B8%D0%BA%D0%BB-%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%BE%D0%B2-%D0%B2-terraform/</guid>
            <description>Как работает обновление ресурсов? По-умолчанию существующий ресурс удаляется, создаётся новый и все ссылки на старый ресурс заменяются ссылками на новый.
Возможно ли изменить стандартный жизненный цикл? Да, существует несколько вариантов, например create_before_destroy, при котором порядок обновления изменяется: сначала создаётся новый ресурс, обновляются ссылки, а затем старый ресурс удаляется.
lifecycle { create_before_destroy = true } Причина для использования такого порядка обновления: в определённых случаях ресурс может иметь иммутабельные зависимости, которые нельзя обновить без пересоздания.</description>
            <content type="html"><![CDATA[<h2 id="как-работает-обновление-ресурсов">Как работает обновление ресурсов?</h2>
<p>По-умолчанию существующий ресурс удаляется, создаётся новый и все ссылки на старый ресурс заменяются ссылками на новый.</p>
<h2 id="возможно-ли-изменить-стандартный-жизненный-цикл">Возможно ли изменить стандартный жизненный цикл?</h2>
<p>Да, существует несколько вариантов, например <code>create_before_destroy</code>, при котором порядок обновления изменяется: сначала создаётся новый ресурс, обновляются ссылки, а затем старый ресурс удаляется.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">lifecycle</span> {
</span></span><span style="display:flex;"><span>  create_before_destroy <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Причина для использования такого порядка обновления: в определённых случаях ресурс может иметь иммутабельные зависимости, которые нельзя обновить без пересоздания. В таком случае стандартный жизненный цикл не сработает: сначала придётся пересоздать зависимые ресурсы, а только потом основной.</p>
]]></content>
        </item>
        
        <item>
            <title>Запрет доступа по IP адресу</title>
            <link>https://weirdvic.github.io/mycelium/%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D0%BF%D0%BE-ip-%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D1%83/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D0%BF%D0%BE-ip-%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D1%83/</guid>
            <description>Даже в случае если сайт хостится за прокси типа Cloudflare, полезно ограничить прямой доступ по IP адресу сервера. В Nginx версии 1.19.4 и новее можно использовать такой конфиг:
server { listen 80 default_server; listen [::]:80 default_server; listen 443 default_server; listen [::]:443 default_server; ssl_reject_handshake on; server_name _; return 444; } В более старых версиях для достижения такого же результата придётся сначала сгенерировать самоподписной SSL сертификат:
sudo openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout default.</description>
            <content type="html"><![CDATA[<p>Даже в случае если сайт хостится за прокси типа <a href="/mycelium/cloudflare/">Cloudflare</a>, полезно ограничить прямой доступ по IP адресу сервера.
В <a href="/mycelium/nginx/">Nginx</a> версии 1.19.4 и новее можно использовать такой конфиг:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cfg" data-lang="cfg"><span style="display:flex;"><span><span style="color:#a6e22e">server {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">listen 80 default_server;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">listen [::]:80 default_server;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">listen 443 default_server;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">listen [::]:443 default_server;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ssl_reject_handshake on;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">server_name _;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">return 444;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">}</span>
</span></span></code></pre></div><p>В более старых версиях для достижения такого же результата придётся сначала сгенерировать самоподписной SSL сертификат:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo openssl req -x509 -nodes -days <span style="color:#ae81ff">3650</span> -newkey rsa:2048 -keyout default.key -out default.crt -subj <span style="color:#e6db74">&#39;/CN=&#39;</span>
</span></span></code></pre></div><p>После этого можно использовать такой конфиг дефолтного сервера:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cfg" data-lang="cfg"><span style="display:flex;"><span><span style="color:#a6e22e">server {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">listen 80 default_server;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">listen [::]:80 default_server;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">listen 443 default_server;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">listen [::]:443 default_server;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ssl_certificate /etc/nginx/ssl/default.crt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ssl_certificate_key /etc/nginx/ssl/default.key;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">server_name _;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">return 444;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">}</span>
</span></span></code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Изменить разрешения на уровне схемы Изменить разрешения на уровне схемы</title>
            <link>https://weirdvic.github.io/mycelium/%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B8%D1%82%D1%8C-%D1%80%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BD%D0%B0-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D0%B5-%D1%81%D1%85%D0%B5%D0%BC%D1%8B-%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B8%D1%82%D1%8C-%D1%80%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BD%D0%B0-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D0%B5-%D1%81%D1%85%D0%B5%D0%BC%D1%8B/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B8%D1%82%D1%8C-%D1%80%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BD%D0%B0-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D0%B5-%D1%81%D1%85%D0%B5%D0%BC%D1%8B-%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B8%D1%82%D1%8C-%D1%80%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BD%D0%B0-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D0%B5-%D1%81%D1%85%D0%B5%D0%BC%D1%8B/</guid>
            <description>GRANT SELECT ON ALL TABLES IN SCHEMA project_1 TO analytic; </description>
            <content type="html"><![CDATA[<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">ALL</span> TABLES <span style="color:#66d9ef">IN</span> <span style="color:#66d9ef">SCHEMA</span> project_1 <span style="color:#66d9ef">TO</span> analytic;
</span></span></code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Использование provisioners в Terraform</title>
            <link>https://weirdvic.github.io/mycelium/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-provisioners-%D0%B2-terraform/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-provisioners-%D0%B2-terraform/</guid>
            <description>Что такое поставщики (provisioners) Допустим мы создали виртуальную машину и нам необходимо передать ей какие-либо данные или запустить какую-либо команду, как это можно сделать средствами Terraform? Ответ: с использованием provisioners. Поставщики можно описать как плагин для Terraform, позволяющий выполнять некоторые задачи по конфигурации сервисов. Типичные задачи, для которых используются поставщики:
Запустить софт для управления конфигурациями, такой как Ansible. Скопировать файлы Выполнить скрипт на удалённой машине Почему к provisioners рекомендуется прибегать только в самом крайнем случае?</description>
            <content type="html"><![CDATA[<h2 id="что-такое-поставщики--provisioners">Что такое поставщики (provisioners)</h2>
<p>Допустим мы создали виртуальную машину и нам необходимо передать ей какие-либо данные или запустить какую-либо команду, как это можно сделать средствами Terraform? Ответ: с использованием <a href="https://developer.hashicorp.com/terraform/language/resources/provisioners/syntax">provisioners</a>. Поставщики можно описать как плагин для Terraform, позволяющий выполнять некоторые задачи по конфигурации сервисов. Типичные задачи, для которых используются поставщики:</p>
<ul>
<li>Запустить софт для управления конфигурациями, такой как <a href="/mycelium/ansible/">Ansible</a>.</li>
<li>Скопировать файлы</li>
<li>Выполнить скрипт на удалённой машине</li>
</ul>
<h2 id="почему-к-provisioners-рекомендуется-прибегать-только-в-самом-крайнем-случае">Почему к provisioners рекомендуется прибегать только в самом крайнем случае?</h2>
<p>Поскольку поставщик может выполнять большой диапазон действий, практически невозможно отследить изменения в системе, произошедшие после срабатывания поставщика, так что в случае если можно обойтись средствами провайдера, следует так и поступать.</p>
<h2 id="что-такое-tainted-resource">Что такое &ldquo;tainted resource&rdquo;</h2>
<p>Ресурс, который был успешно создан Terraform, но удалось выкатить.</p>
<h2 id="для-чего-нужен-terraform-taint">Для чего нужен <code>terraform taint</code>?</h2>
<p>Команда <code>terraform taint resource.id</code> позволяет вручную отметить ресурс как сломаный, так что при следующем запуске <code>terraform apply</code> ресурс будет удалён и создан снова.</p>
]]></content>
        </item>
        
        <item>
            <title>Какие таблицы Clickhouse занимают место на диске</title>
            <link>https://weirdvic.github.io/mycelium/%D0%BA%D0%B0%D0%BA%D0%B8%D0%B5-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D1%8B-clickhouse-%D0%B7%D0%B0%D0%BD%D0%B8%D0%BC%D0%B0%D1%8E%D1%82-%D0%BC%D0%B5%D1%81%D1%82%D0%BE-%D0%BD%D0%B0-%D0%B4%D0%B8%D1%81%D0%BA%D0%B5/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%BA%D0%B0%D0%BA%D0%B8%D0%B5-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D1%8B-clickhouse-%D0%B7%D0%B0%D0%BD%D0%B8%D0%BC%D0%B0%D1%8E%D1%82-%D0%BC%D0%B5%D1%81%D1%82%D0%BE-%D0%BD%D0%B0-%D0%B4%D0%B8%D1%81%D0%BA%D0%B5/</guid>
            <description>SELECT &amp;#34;table&amp;#34;, formatReadableSize(sum(bytes)) AS &amp;#34;size&amp;#34; FROM system.parts WHERE active GROUP BY &amp;#34;table&amp;#34; ORDER BY &amp;#34;size&amp;#34; DESC ; </description>
            <content type="html"><![CDATA[<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#34;table&#34;</span>,
</span></span><span style="display:flex;"><span>       formatReadableSize(<span style="color:#66d9ef">sum</span>(bytes)) <span style="color:#66d9ef">AS</span> <span style="color:#e6db74">&#34;size&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> <span style="color:#66d9ef">system</span>.parts
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> active
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#34;table&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#34;size&#34;</span> <span style="color:#66d9ef">DESC</span>
</span></span><span style="display:flex;"><span>;
</span></span></code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Особенности Terraform</title>
            <link>https://weirdvic.github.io/mycelium/%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8-terraform/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8-terraform/</guid>
            <description> Декларативность. Terraform использует декларативный подход для описания конечного состояния ресурсов. Отсутствие агентов. В отличие от других технологий Terraform не использует клиент-серверную модель, а полагается на различные API для выполнения манипуляций с ресурсами. Сильная поддержка сообщества для модулей и провайдеров и наличие большого количества готовых инструментов. </description>
            <content type="html"><![CDATA[<ul>
<li>Декларативность. Terraform использует декларативный подход для описания конечного состояния ресурсов.</li>
<li>Отсутствие агентов. В отличие от других технологий Terraform не использует клиент-серверную модель, а полагается на различные API для выполнения манипуляций с ресурсами.</li>
<li>Сильная поддержка сообщества для модулей и <a href="/mycelium/%D0%BF%D1%80%D0%BE%D0%B2%D0%B0%D0%B9%D0%B4%D0%B5%D1%80%D1%8B-terraform/">провайдеров</a> и наличие большого количества готовых инструментов.</li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Отключение логирования запросов Clickhouse</title>
            <link>https://weirdvic.github.io/mycelium/%D0%BE%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BB%D0%BE%D0%B3%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%BE%D0%B2-clickhouse/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%BE%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BB%D0%BE%D0%B3%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%BE%D0%B2-clickhouse/</guid>
            <description>В файле /etc/clickhouse-server/users.d/disable-query-logging.xml:
&amp;lt;yandex&amp;gt; &amp;lt;profiles&amp;gt; &amp;lt;default&amp;gt; &amp;lt;log_queries&amp;gt;0&amp;lt;/log_queries&amp;gt; &amp;lt;log_query_threads&amp;gt;0&amp;lt;/log_query_threads&amp;gt; &amp;lt;/default&amp;gt; &amp;lt;/profiles&amp;gt; &amp;lt;/yandex&amp;gt; В новых версиях Clickhouse вместо &amp;lt;yandex&amp;gt; использовать &amp;lt;clickhouse&amp;gt;.</description>
            <content type="html"><![CDATA[<p>В файле <code>/etc/clickhouse-server/users.d/disable-query-logging.xml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;yandex&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;profiles&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;default&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;log_queries&gt;</span>0<span style="color:#f92672">&lt;/log_queries&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;log_query_threads&gt;</span>0<span style="color:#f92672">&lt;/log_query_threads&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/default&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/profiles&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/yandex&gt;</span>
</span></span></code></pre></div><p>В новых версиях Clickhouse вместо <code>&lt;yandex&gt;</code> использовать <code>&lt;clickhouse&gt;</code>.</p>
]]></content>
        </item>
        
        <item>
            <title>Переменные в Terraform</title>
            <link>https://weirdvic.github.io/mycelium/%D0%BF%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5-%D0%B2-terraform/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%BF%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5-%D0%B2-terraform/</guid>
            <description>Для чего используются переменные (input variables) в Terraform? Для того же, для чего и в программировании — для обращения по имени к какому-либо значению.
Типы переменных, поддерживаемые в Terraform? string number bool list(&amp;lt;TYPE&amp;gt;) set(&amp;lt;TYPE&amp;gt;) map(&amp;lt;TYPE&amp;gt;) object({&amp;lt;ATTR_NAME&amp;gt; = &amp;lt;TYPE&amp;gt;, &amp;hellip; }) tuple([&amp;lt;TYPE&amp;gt;, &amp;hellip;]) Какой тип переменной используется по-умолчанию? any
Способы передать значения для переменных? С использованием опции -var в командной строке. С использованием файла переменных и опции -var-file. Через переменные окружения, которые начинаются с TF_VAR_&amp;lt;VAR_NAME&amp;gt; Если не значение не было передано, оно будет запрошено в процессе выполнения команды.</description>
            <content type="html"><![CDATA[<h2 id="для-чего-используются-переменные--input-variables--в-terraform">Для чего используются переменные (input variables) в Terraform?</h2>
<p>Для того же, для чего и в программировании — для обращения по имени к какому-либо значению.</p>
<h2 id="типы-переменных-поддерживаемые-в-terraform">Типы переменных, поддерживаемые в Terraform?</h2>
<ul>
<li>string</li>
<li>number</li>
<li>bool</li>
<li>list(&lt;TYPE&gt;)</li>
<li>set(&lt;TYPE&gt;)</li>
<li>map(&lt;TYPE&gt;)</li>
<li>object({&lt;ATTR_NAME&gt; = &lt;TYPE&gt;, &hellip; })</li>
<li>tuple([&lt;TYPE&gt;, &hellip;])</li>
</ul>
<h2 id="какой-тип-переменной-используется-по-умолчанию">Какой тип переменной используется по-умолчанию?</h2>
<p><code>any</code></p>
<h2 id="способы-передать-значения-для-переменных">Способы передать значения для переменных?</h2>
<ul>
<li>С использованием опции <code>-var</code> в командной строке.</li>
<li>С использованием файла переменных и опции <code>-var-file</code>.</li>
<li>Через переменные окружения, которые начинаются с <code>TF_VAR_&lt;VAR_NAME&gt;</code></li>
</ul>
<p>Если не значение не было передано, оно будет запрошено в процессе выполнения команды.</p>
<h2 id="как-сослаться-на-переменную">Как сослаться на переменную?</h2>
<p>С использованием синтакса <code>var.&lt;VAR_NAME&gt;</code></p>
<h2 id="какой-смысл-отмечать-переменные-как-sensitive">Какой смысл отмечать переменные как &ldquo;sensitive&rdquo;?</h2>
<p>Значение таких переменных не отображается в логах выполнения команд <code>terraform apply</code> и <code>terraform plan</code>, но всё равно попадает в файл состояния. Если результат выражения зависит от значения такой переменной, он тоже становится &ldquo;чувствительным&rdquo;.</p>
<h2 id="что-такое-выходные-переменные--output-variables">Что такое выходные переменные (output variables)?</h2>
<p>Выходные переменные позволяют выводить определённые значения в процессе исполнения команд Terraform. Наверное самый распространённый пример использования таких переменных это вывод IP адреса создаваемого инстанса сразу после его создания.</p>
<h2 id="пример-определения-переменной-с-указанием-типа-и-дефолтными-параметрами">Пример определения переменной с указанием типа и дефолтными параметрами</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">variable</span> <span style="color:#e6db74">&#34;app_id&#34;</span> {
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>  description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;The id of application&#34;</span>
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;some_value&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Примечание: обычно переменные определяются в отдельном файле, например <code>vars.tf</code></p>
<h2 id="как-определить-переменную-объект-с-несколькими-разными-аттрибутами">Как определить переменную-объект с несколькими разными аттрибутами?</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">variable</span> <span style="color:#e6db74">&#34;car_model&#34;</span> {
</span></span><span style="display:flex;"><span>  description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Car model object&#34;</span>
</span></span><span style="display:flex;"><span>  type        <span style="color:#f92672">=</span> <span style="color:#66d9ef">object</span>({
</span></span><span style="display:flex;"><span>    model   <span style="color:#f92672">=</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    color   <span style="color:#f92672">=</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    year    <span style="color:#f92672">=</span> <span style="color:#66d9ef">number</span>
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="пример-обращения-к-переменной">Пример обращения к переменной</h2>
<p>В файле <code>vars.tf</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">variable</span> <span style="color:#e6db74">&#34;memory&#34;</span> {
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">default</span> <span style="color:#e6db74">&#34;8192&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">variable</span> <span style="color:#e6db74">&#34;cpu&#34;</span> {
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;4&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>В файле <code>main.tf</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;libvirt_domain&#34; &#34;vm1&#34;</span> {
</span></span><span style="display:flex;"><span>   name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vm1&#34;</span>
</span></span><span style="display:flex;"><span>   memory <span style="color:#f92672">=</span> <span style="color:#66d9ef">var</span>.<span style="color:#66d9ef">memory</span>
</span></span><span style="display:flex;"><span>   cpu <span style="color:#f92672">=</span> <span style="color:#66d9ef">var</span>.<span style="color:#66d9ef">cpu</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="что-такое-локали--locals">Что такое локали (locals)?</h2>
<p>Локали это аналог констант в программировании: их значение задаётся один раз и не может быть изменено пользователем.</p>
<h2 id="пример-определения-локали">Пример определения локали</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">locals</span> {
</span></span><span style="display:flex;"><span>  x <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;o&#34;</span>
</span></span><span style="display:flex;"><span>  z <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>.<span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="пример-использования-локали">Пример использования локали</h2>
<p>Аналогично использованию переменных, но с ключевым словом local вместо var, например <code>local.x</code></p>
]]></content>
        </item>
        
        <item>
            <title>Провайдеры Terraform</title>
            <link>https://weirdvic.github.io/mycelium/%D0%BF%D1%80%D0%BE%D0%B2%D0%B0%D0%B9%D0%B4%D0%B5%D1%80%D1%8B-terraform/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D0%BF%D1%80%D0%BE%D0%B2%D0%B0%D0%B9%D0%B4%D0%B5%D1%80%D1%8B-terraform/</guid>
            <description>Terraform использует систему плагинов, называемых провайдерами (providers) для взаимодействия с облачными платформами или другими сервисами посредством API.
Уже существует более 1000 провайдеров для управления ресурсами на:
Amazon Web Services (AWS) Google Cloud Platform (GCP) Oracle Cloud Azure Kubernetes GitHub Splunk DataDog и огромным количеством других.
Репозиторий провайдеров находится в Terraform Registry</description>
            <content type="html"><![CDATA[<p>Terraform использует систему плагинов, называемых провайдерами (providers) для взаимодействия с облачными платформами или другими сервисами посредством API.</p>
<p>Уже существует более 1000 провайдеров для управления ресурсами на:</p>
<ul>
<li>Amazon Web Services (AWS)</li>
<li><a href="/mycelium/google-cloud-platform/">Google Cloud Platform</a> (GCP)</li>
<li>Oracle Cloud</li>
<li>Azure</li>
<li><a href="/mycelium/kubernetes/">Kubernetes</a></li>
<li>GitHub</li>
<li>Splunk</li>
<li>DataDog</li>
</ul>
<p>и огромным количеством других.</p>
<p>Репозиторий провайдеров находится в <a href="https://registry.terraform.io/browse/providers">Terraform Registry</a></p>
]]></content>
        </item>
        
        <item>
            <title>Состояние в Terrafrom</title>
            <link>https://weirdvic.github.io/mycelium/%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5-%D0%B2-terrafrom/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5-%D0%B2-terrafrom/</guid>
            <description>Под состоянием или state в Terraform понимается состояние инфраструктуры и конфигурации, о котором &amp;ldquo;знает&amp;rdquo; Terraform. При этом оно вполне может отличаться от фактического состояния ресурсов. В самом простом варианте состояние хранится в файле terraform.tfstate и представляет собой JSON файл. Лучшие практики в работе с tfstate:
Не редактировать файл состояния вручную. Файл не предназначен для ручного редактирования. Хранить файл в защищённом месте, поскольку в нём содержаться секретные данные в виде простого текста.</description>
            <content type="html"><![CDATA[<p>Под состоянием или state в Terraform понимается состояние инфраструктуры и конфигурации, о котором &ldquo;знает&rdquo; Terraform. При этом оно вполне может отличаться от фактического состояния ресурсов. В самом простом варианте состояние хранится в файле <code>terraform.tfstate</code> и представляет собой JSON файл.
Лучшие практики в работе с tfstate:</p>
<ul>
<li>Не редактировать файл состояния вручную. Файл не предназначен для ручного редактирования.</li>
<li>Хранить файл в защищённом месте, поскольку в нём содержаться секретные данные в виде простого текста.</li>
<li>Делать регулярные бэкапы файлов состояния.</li>
<li>В случае работы команды файл состояния надо хранить в удалённом хранилище, желательно с поддержкой версионирования для возможности отката к старым версиям.</li>
</ul>
<h2 id="какая-команда-создаёт-файл-состояния">Какая команда создаёт файл состояния?</h2>
<p><code>terraform apply</code></p>
<h2 id="как-просмотреть-текущее-состояние">Как просмотреть текущее состояние?</h2>
<p><code>terraform show</code></p>
<h2 id="как-просмотреть-ресурсы-созданные-через-terraform">Как просмотреть ресурсы, созданные через Terraform?</h2>
<p><code>terraform state list</code></p>
<h2 id="как-переименовать-существующий-ресурс">Как переименовать существующий ресурс?</h2>
<p><code>terraform state mv</code></p>
<h2 id="переключение-на-удалённый-бэкенд">Переключение на удалённый бэкенд</h2>
<p>По умолчанию для работы с состоянием используется бэкенд <code>local</code>, но можно и нужно использовать удалённые бэкенды на свой выбор. Переключение бэкенда на примере перехода на S3:</p>
<ul>
<li>Написать tf код для создания бакета в S3, хорошей идеей будет добавить параметр <code>prevent_destroy</code> в жизненный цикл.</li>
<li>Включить версионирование бакета.</li>
<li>Включить шифрование.</li>
<li>Заблокировать публичный доступ.</li>
<li>Решить как будет реализована блокировка.</li>
<li>Применить код чтобы бакет был создан.</li>
<li>Переключиться в коде на использование удалённого бэкенда:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">terraform</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">backend</span> <span style="color:#e6db74">&#34;s3&#34;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bucket</span> ...
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>Запустить <code>terraform init</code> чтобы переключиться на удалённый бэкенд.</li>
</ul>
<h2 id="что-меняется-в-выполнении-terraform-apply-при-использовании-удалённого-бэкенда">Что меняется в выполнении <code>terraform apply</code> при использовании удалённого бэкенда?</h2>
<p>Выполнение <code>terraform apply</code> начинается с блокировки состояния чтобы предотвратить изменения в конфигурацию ресурсов.</p>
<h2 id="как-переключиться-обратно-с-удалённого-бэкенда-на-локальный">Как переключиться обратно с удалённого бэкенда на локальный?</h2>
<ul>
<li>Удалить код, определяющий удалённый бэкенд и снова запустить <code>terraform init</code></li>
<li>Удалить ресурсы, представляющие сам бэкенд(например, бакет в случае S3)</li>
</ul>
<h2 id="возможно-ли-использовать-переменные-в-конфигурации-бэкенда">Возможно ли использовать переменные в конфигурации бэкенда?</h2>
<p>Нет, нельзя. Придётся вручную пойти в консоль облачного провайдера и скопировать значения оттуда.
Есть костыль в виде хранения части конфигурации бэкенда локально и загрузке её при выполнении:
<code>terraform init -backend-config=some_backend_partial_conf.hcl</code></p>
<h2 id="как-можно-получить-данные-из-удалённого-бэкенда">Как можно получить данные из удалённого бэкенда?</h2>
<p>С использованием <a href="/mycelium/data-sources-%D0%B2-terraform/">источников данных</a>. В частности, можно использовать такой синтакс:
<code>data.terraform_remote_state.&lt;NAME&gt;.outputs.&lt;ATTRIBUTE&gt;</code></p>
]]></content>
        </item>
        
        <item>
            <title>Структуры данных Terraform</title>
            <link>https://weirdvic.github.io/mycelium/%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D1%8B-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-terraform/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D1%8B-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-terraform/</guid>
            <description>Как определить переменную в виде списка чисел? variable &amp;#34;list_of_nums&amp;#34; { type = list(number) description = &amp;#34;An example of list of numbers&amp;#34; default = [2, 0, 1, 7] } Как создать ресурсы в количестве, равном длине списка? resource &amp;#34;some_resource&amp;#34; &amp;#34;some_name&amp;#34; { count = length(var.some_list) } Как получить аттрибут &amp;ldquo;name&amp;rdquo; второго элемента списка &amp;ldquo;users&amp;rdquo;? users[1].name Как получить аттрибут &amp;ldquo;name&amp;rdquo; всех элементов списка &amp;ldquo;users&amp;rdquo;? users[*].name Для чего используются циклы в Terraform? Чаще всего для создания нескольких ресурсов, различающихся незначительно: например только именем.</description>
            <content type="html"><![CDATA[<h2 id="как-определить-переменную-в-виде-списка-чисел">Как определить переменную в виде списка чисел?</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">variable</span> <span style="color:#e6db74">&#34;list_of_nums&#34;</span> {
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span> <span style="color:#66d9ef">list</span>(<span style="color:#66d9ef">number</span>)
</span></span><span style="display:flex;"><span>  description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;An example of list of numbers&#34;</span>
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> [<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">7</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="как-создать-ресурсы-в-количестве-равном-длине-списка">Как создать ресурсы в количестве, равном длине списка?</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;some_resource&#34; &#34;some_name&#34;</span> {
</span></span><span style="display:flex;"><span>  count <span style="color:#f92672">=</span> <span style="color:#66d9ef">length</span>(<span style="color:#66d9ef">var</span>.<span style="color:#66d9ef">some_list</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="как-получить-аттрибут-name-второго-элемента-списка-users">Как получить аттрибут &ldquo;name&rdquo; второго элемента списка &ldquo;users&rdquo;?</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">users</span>[<span style="color:#ae81ff">1</span>].<span style="color:#66d9ef">name</span>
</span></span></code></pre></div><h2 id="как-получить-аттрибут-name-всех-элементов-списка-users">Как получить аттрибут &ldquo;name&rdquo; всех элементов списка &ldquo;users&rdquo;?</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">users</span>[<span style="color:#960050;background-color:#1e0010">*</span>].<span style="color:#66d9ef">name</span>
</span></span></code></pre></div><h2 id="для-чего-используются-циклы-в-terraform">Для чего используются циклы в Terraform?</h2>
<p>Чаще всего для создания нескольких ресурсов, различающихся незначительно: например только именем.</p>
<h2 id="пример-простого-цикла-в-terraform">Пример простого цикла в Terraform</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_instance&#34; &#34;server&#34;</span> {
</span></span><span style="display:flex;"><span>  count <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Эта конфигурация создаст 15 экземпляров инстансов AWS. Если мы хотим задать имена здесь же, фрагмент кода будет выглядеть так:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_instance&#34; &#34;server&#34;</span> {
</span></span><span style="display:flex;"><span>  count <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;instance-${count.index}&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="как-использовать-значения-из-списка-в-цикле">Как использовать значения из списка в цикле?</h2>
<p>Допустим, у нас есть такой список имён пользователей:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">variable</span> <span style="color:#e6db74">&#34;users&#34;</span> {
</span></span><span style="display:flex;"><span>  type    <span style="color:#f92672">=</span> <span style="color:#66d9ef">list</span>(<span style="color:#66d9ef">string</span>)
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;mario&#34;, &#34;luigi&#34;, &#34;peach&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Чтобы создать пользователей(или другой ресурс) с именами из списка, можно использовать такой код:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_iam_user&#34; &#34;user&#34;</span> {
</span></span><span style="display:flex;"><span>  count <span style="color:#f92672">=</span> <span style="color:#66d9ef">length</span>(<span style="color:#66d9ef">var</span>.<span style="color:#66d9ef">users</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  name <span style="color:#f92672">=</span> <span style="color:#66d9ef">var</span>.<span style="color:#66d9ef">users</span>[<span style="color:#66d9ef">count</span>.<span style="color:#66d9ef">index</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="ограничения-при-использовании-count">Ограничения при использовании <code>count</code></h2>
<ol>
<li><code>сount</code> нельзя использовать во вложенных блоках.</li>
<li>использование <code>count</code> в работе со списками имеет свои особенности. Например, при удалении элементов из списка, остальные элементы меняют индекс, что может привести к непредвиденным последствиям. Есть способы избежать такого поведения, но в целом при использовании <code>count</code> нужно быть осторожным.</li>
</ol>
<h2 id="что-такое-цикл-for-each-и-чем-он-отличается-от-count">Что такое цикл <code>for_each</code> и чем он отличается от <code>count</code>?</h2>
<ul>
<li><code>for_each</code> может использоваться только с типами коллеций, как мапы(maps) и наборы(sets), в отличие от <code>count</code>, применяемого со списками.</li>
<li><code>for_each</code> может использоваться во вложенных блоках.</li>
</ul>
<h2 id="пример-использования-цикла-for-each">Пример использования цикла <code>for_each</code></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#960050;background-color:#1e0010">“</span><span style="color:#66d9ef">google_compute_instance</span><span style="color:#960050;background-color:#1e0010">”</span> <span style="color:#960050;background-color:#1e0010">“</span><span style="color:#66d9ef">instances</span><span style="color:#960050;background-color:#1e0010">”</span> {
</span></span><span style="display:flex;"><span>  for_each <span style="color:#f92672">=</span> <span style="color:#66d9ef">var</span>.<span style="color:#66d9ef">names_map</span>
</span></span><span style="display:flex;"><span>  name <span style="color:#f92672">=</span> <span style="color:#66d9ef">each</span>.<span style="color:#66d9ef">value</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="как-for-each-используется-во-вложенных-блоках">Как <code>for_each</code> используется во вложенных блоках?</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">resouce</span> <span style="color:#e6db74">&#34;some_instance&#34; &#34;instance&#34;</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">dynamic</span> <span style="color:#e6db74">&#34;tag&#34;</span> {
</span></span><span style="display:flex;"><span>  for_each <span style="color:#f92672">=</span> <span style="color:#66d9ef">var</span>.<span style="color:#66d9ef">tags</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">content</span> {
</span></span><span style="display:flex;"><span>    key   <span style="color:#f92672">=</span> <span style="color:#66d9ef">tag</span>.<span style="color:#66d9ef">key</span>
</span></span><span style="display:flex;"><span>    value <span style="color:#f92672">=</span> <span style="color:#66d9ef">tag</span>.<span style="color:#66d9ef">value</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Удаление www из URL</title>
            <link>https://weirdvic.github.io/mycelium/%D1%83%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-www-%D0%B8%D0%B7-url/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D1%83%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-www-%D0%B8%D0%B7-url/</guid>
            <description>Иногда требуется автоматически перенаправлять запросы с www-доменов на домен без www. В Nginx это можно сделать следующим образом:
server { server_name ~^(www\.)(?&amp;lt;domain&amp;gt;.+)$; return 301 $scheme://$domain$request_uri; } Важно отметить что этот способ будет хорошо работать только для HTTP запросов. В случае с HTTPS придётся добавлять версию домена с www в сертификат сайта.</description>
            <content type="html"><![CDATA[<p>Иногда требуется автоматически перенаправлять запросы с www-доменов на домен без www. В <a href="/mycelium/nginx/">Nginx</a> это можно сделать следующим образом:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cfg" data-lang="cfg"><span style="display:flex;"><span><span style="color:#a6e22e">server {</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">server_name ~^(www\.)(?&lt;domain&gt;.+)$;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">return 301 $scheme://$domain$request_uri;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">}</span>
</span></span></code></pre></div><p>Важно отметить что этот способ будет хорошо работать только для HTTP запросов. В случае с HTTPS придётся добавлять версию домена с www в сертификат сайта.</p>
]]></content>
        </item>
        
        <item>
            <title>Уменьшение уровня логирования Clickhouse</title>
            <link>https://weirdvic.github.io/mycelium/%D1%83%D0%BC%D0%B5%D0%BD%D1%8C%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8F-%D0%BB%D0%BE%D0%B3%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-clickhouse/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D1%83%D0%BC%D0%B5%D0%BD%D1%8C%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8F-%D0%BB%D0%BE%D0%B3%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-clickhouse/</guid>
            <description>В файле /etc/clickhouse-server/config.d/set-log-level.xml:
&amp;lt;yandex&amp;gt; &amp;lt;logger&amp;gt; &amp;lt;level&amp;gt;warning&amp;lt;/level&amp;gt; &amp;lt;console&amp;gt;true&amp;lt;/console&amp;gt; &amp;lt;/logger&amp;gt; &amp;lt;query_thread_log remove=&amp;#34;remove&amp;#34;/&amp;gt; &amp;lt;query_log remove=&amp;#34;remove&amp;#34;/&amp;gt; &amp;lt;text_log remove=&amp;#34;remove&amp;#34;/&amp;gt; &amp;lt;trace_log remove=&amp;#34;remove&amp;#34;/&amp;gt; &amp;lt;metric_log remove=&amp;#34;remove&amp;#34;/&amp;gt; &amp;lt;asynchronous_metric_log remove=&amp;#34;remove&amp;#34;/&amp;gt; &amp;lt;/yandex&amp;gt; В новых версиях Clickhouse вместо &amp;lt;yandex&amp;gt; использовать &amp;lt;clickhouse&amp;gt;. Также можно отключить дополнительные логи:
&amp;lt;session_log remove=&amp;#34;remove&amp;#34;/&amp;gt; &amp;lt;part_log remove=&amp;#34;remove&amp;#34;/&amp;gt; </description>
            <content type="html"><![CDATA[<p>В файле <code>/etc/clickhouse-server/config.d/set-log-level.xml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;yandex&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;logger&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;level&gt;</span>warning<span style="color:#f92672">&lt;/level&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;console&gt;</span>true<span style="color:#f92672">&lt;/console&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/logger&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;query_thread_log</span> <span style="color:#a6e22e">remove=</span><span style="color:#e6db74">&#34;remove&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;query_log</span> <span style="color:#a6e22e">remove=</span><span style="color:#e6db74">&#34;remove&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;text_log</span> <span style="color:#a6e22e">remove=</span><span style="color:#e6db74">&#34;remove&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;trace_log</span> <span style="color:#a6e22e">remove=</span><span style="color:#e6db74">&#34;remove&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;metric_log</span> <span style="color:#a6e22e">remove=</span><span style="color:#e6db74">&#34;remove&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;asynchronous_metric_log</span> <span style="color:#a6e22e">remove=</span><span style="color:#e6db74">&#34;remove&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/yandex&gt;</span>
</span></span></code></pre></div><p>В новых версиях Clickhouse вместо <code>&lt;yandex&gt;</code> использовать <code>&lt;clickhouse&gt;</code>.
Также можно отключить дополнительные логи:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;session_log</span> <span style="color:#a6e22e">remove=</span><span style="color:#e6db74">&#34;remove&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;part_log</span> <span style="color:#a6e22e">remove=</span><span style="color:#e6db74">&#34;remove&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span></code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Условные выражения в Terraform</title>
            <link>https://weirdvic.github.io/mycelium/%D1%83%D1%81%D0%BB%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5-%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B2-terraform/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D1%83%D1%81%D0%BB%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5-%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B2-terraform/</guid>
            <description>Как использовать условные выражения в Terraform? some_condition ? &amp;#34;value_if_true&amp;#34; : &amp;#34;value_if_false&amp;#34; Возможно ли сочетать условные выражения и циклы? dynamic &amp;#34;tag&amp;#34; { for_each = { for key, value in var.tags: key =&amp;gt; value if key != &amp;#34;&amp;#34; } } </description>
            <content type="html"><![CDATA[<h2 id="как-использовать-условные-выражения-в-terraform">Как использовать условные выражения в Terraform?</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">some_condition</span> <span style="color:#960050;background-color:#1e0010">?</span> <span style="color:#e6db74">&#34;value_if_true&#34; : &#34;value_if_false&#34;</span>
</span></span></code></pre></div><h2 id="возможно-ли-сочетать-условные-выражения-и-циклы">Возможно ли сочетать условные выражения и циклы?</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">dynamic</span> <span style="color:#e6db74">&#34;tag&#34;</span> {
</span></span><span style="display:flex;"><span>  for_each <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">key</span>, <span style="color:#66d9ef">value</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">var</span>.<span style="color:#66d9ef">tags</span><span style="color:#960050;background-color:#1e0010">:</span>
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#66d9ef">value</span>
</span></span><span style="display:flex;"><span>    if key !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Что такое мета-аргументы Terraform?</title>
            <link>https://weirdvic.github.io/mycelium/%D1%87%D1%82%D0%BE-%D1%82%D0%B0%D0%BA%D0%BE%D0%B5-%D0%BC%D0%B5%D1%82%D0%B0-%D0%B0%D1%80%D0%B3%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B-terraform/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D1%87%D1%82%D0%BE-%D1%82%D0%B0%D0%BA%D0%BE%D0%B5-%D0%BC%D0%B5%D1%82%D0%B0-%D0%B0%D1%80%D0%B3%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B-terraform/</guid>
            <description>Мета-аргументы влияют на жизненный цикл ресурса и поддерживаются вне зависимости от типа ресурса. Например:
count — количество ресурсов, которые нужно создать или изменить из единого определения. lifecycle — как поступать в случае необходимости создания или удаления ресурса. depends_on — создание зависимости между ресурсами. </description>
            <content type="html"><![CDATA[<p>Мета-аргументы влияют на жизненный цикл ресурса и поддерживаются вне зависимости от типа ресурса.
Например:</p>
<ul>
<li><code>count</code> — количество ресурсов, которые нужно создать или изменить из единого определения.</li>
<li><code>lifecycle</code> — как поступать в случае необходимости создания или удаления ресурса.</li>
<li><code>depends_on</code> — создание зависимости между ресурсами.</li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Terraform</title>
            <link>https://weirdvic.github.io/mycelium/terraform/</link>
            <pubDate>Fri, 21 Jul 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/terraform/</guid>
            <description>Terraform это инструмент с открытым исходным кодом, разрабатываемый HashiCorp. Terraform предназначен для реализации концепции Infrastructure as Code (IaC) в части управления IT инфраструктурой. Terraform обычно использует HashiCorp Configuration Language (HCL) для декларативного описания желаемого состояния конфигурации. Сам Terraform написан на Go и предоставляет утилиту командной строки terraform.
Для управления различными инфраструктурными ресурсами Terraform использует так называемые &amp;ldquo;провайдеры&amp;rdquo; (providers) Если провести аналогию с софтом для работы с базами данных, то провайдеры Terraform это как драйверы для различных СУБД.</description>
            <content type="html"><![CDATA[<p>Terraform это инструмент с открытым исходным кодом, разрабатываемый HashiCorp. Terraform предназначен для реализации концепции <a href="/mycelium/infrastructure-as-code/">Infrastructure as Code</a> (IaC) в части управления IT инфраструктурой. Terraform обычно использует HashiCorp Configuration Language (HCL) для декларативного описания желаемого состояния конфигурации. Сам Terraform написан на <a href="/mycelium/%D1%8F%D0%B7%D1%8B%D0%BA-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-go/">Go</a> и предоставляет утилиту командной строки <code>terraform</code>.</p>
<p>Для управления различными инфраструктурными ресурсами Terraform использует так называемые &ldquo;<a href="/mycelium/%D0%BF%D1%80%D0%BE%D0%B2%D0%B0%D0%B9%D0%B4%D0%B5%D1%80%D1%8B-terraform/">провайдеры</a>&rdquo; (providers) Если провести аналогию с софтом для работы с базами данных, то провайдеры Terraform это как драйверы для различных СУБД.</p>
<p>Другой важной концепцией Terraform являются &ldquo;<a href="/mycelium/%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D0%B8-terraform/">модули</a>&rdquo; (modules) это сгруппированные логически наборы ресурсов.</p>
<ul>
<li><a href="/mycelium/%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8-terraform/">Особенности Terraform</a></li>
<li><a href="/mycelium/%D1%82%D0%B8%D0%BF%D0%B8%D1%87%D0%BD%D1%8B%D0%B9-%D1%80%D0%B0%D0%B1%D0%BE%D1%87%D0%B8%D0%B9-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81-%D1%81-terraform/">Типичный рабочий процесс с Terraform</a></li>
<li><a href="/mycelium/%D0%B6%D0%B8%D0%B7%D0%BD%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%86%D0%B8%D0%BA%D0%BB-%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%BE%D0%B2-%D0%B2-terraform/">Жизненный цикл ресурсов в Terraform</a></li>
<li><a href="/mycelium/%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5-%D0%B2-terrafrom/">Состояние в Terrafrom</a></li>
<li><a href="/mycelium/%D0%BF%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5-%D0%B2-terraform/">Переменные в Terraform</a></li>
<li><a href="/mycelium/%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D1%8B-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-terraform/">Структуры данных Terraform</a></li>
<li><a href="/mycelium/%D1%83%D1%81%D0%BB%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5-%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B2-terraform/">Условные выражения в Terraform</a></li>
<li><a href="/mycelium/data-sources-%D0%B2-terraform/">Data sources в Terraform</a></li>
<li><a href="/mycelium/%D0%BF%D1%80%D0%BE%D0%B2%D0%B0%D0%B9%D0%B4%D0%B5%D1%80%D1%8B-terraform/">Провайдеры Terraform</a></li>
<li><a href="/mycelium/workspaces-%D0%B2-terraform/">Workspaces в Terraform</a></li>
<li><a href="/mycelium/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-provisioners-%D0%B2-terraform/">Использование provisioners в Terraform</a></li>
<li><a href="/mycelium/%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D0%B8-terraform/">Модули Terraform</a></li>
<li><a href="/mycelium/%D1%87%D1%82%D0%BE-%D1%82%D0%B0%D0%BA%D0%BE%D0%B5-%D0%BC%D0%B5%D1%82%D0%B0-%D0%B0%D1%80%D0%B3%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B-terraform/">Что такое мета-аргументы Terraform?</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Kubernetes</title>
            <link>https://weirdvic.github.io/mycelium/kubernetes/</link>
            <pubDate>Thu, 20 Jul 2023 00:00:00 +0000</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/kubernetes/</guid>
            <description>Kubernetes или K8s это система с открытым исходным кодом для автоматизации развёртывания, масштабирования и управления контейнеризированными приложениями.</description>
            <content type="html"><![CDATA[<p><a href="https://kubernetes.io/">Kubernetes</a> или K8s это система с открытым исходным кодом для автоматизации развёртывания, масштабирования и управления контейнеризированными приложениями.</p>
]]></content>
        </item>
        
        <item>
            <title>PostgreSQL</title>
            <link>https://weirdvic.github.io/mycelium/postgresql/</link>
            <pubDate>Wed, 21 Jun 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/postgresql/</guid>
            <description>Заметки по настройке и обслуживанию СУБД PostgreSQL
Изменить разрешения на уровне схемы 10 самых больших таблиц в базе </description>
            <content type="html"><![CDATA[<p>Заметки по настройке и обслуживанию СУБД <a href="https://www.postgresql.org/">PostgreSQL</a></p>
<ul>
<li><a href="/mycelium/%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B8%D1%82%D1%8C-%D1%80%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BD%D0%B0-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D0%B5-%D1%81%D1%85%D0%B5%D0%BC%D1%8B-%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B8%D1%82%D1%8C-%D1%80%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BD%D0%B0-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D0%B5-%D1%81%D1%85%D0%B5%D0%BC%D1%8B/">Изменить разрешения на уровне схемы</a></li>
<li><a href="/mycelium/10-%D1%81%D0%B0%D0%BC%D1%8B%D1%85-%D0%B1%D0%BE%D0%BB%D1%8C%D1%88%D0%B8%D1%85-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86-%D0%B2-%D0%B1%D0%B0%D0%B7%D0%B5/">10 самых больших таблиц в базе</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Clickhouse</title>
            <link>https://weirdvic.github.io/mycelium/clickhouse/</link>
            <pubDate>Wed, 14 Jun 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/clickhouse/</guid>
            <description>Заметки по настройке и обслуживанию Clickhouse.
Какие таблицы занимают место на диске Отключение логирования запросов Уменьшение уровня логирования Ошибка suspiciously many broken parts to remove </description>
            <content type="html"><![CDATA[<p>Заметки по настройке и обслуживанию <a href="https://clickhouse.com/">Clickhouse</a>.</p>
<ul>
<li><a href="/mycelium/%D0%BA%D0%B0%D0%BA%D0%B8%D0%B5-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D1%8B-clickhouse-%D0%B7%D0%B0%D0%BD%D0%B8%D0%BC%D0%B0%D1%8E%D1%82-%D0%BC%D0%B5%D1%81%D1%82%D0%BE-%D0%BD%D0%B0-%D0%B4%D0%B8%D1%81%D0%BA%D0%B5/">Какие таблицы занимают место на диске</a></li>
<li><a href="/mycelium/%D0%BE%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BB%D0%BE%D0%B3%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%BE%D0%B2-clickhouse/">Отключение логирования запросов</a></li>
<li><a href="/mycelium/%D1%83%D0%BC%D0%B5%D0%BD%D1%8C%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8F-%D0%BB%D0%BE%D0%B3%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-clickhouse/">Уменьшение уровня логирования</a></li>
<li><a href="/mycelium/%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0-suspiciously-many-broken-parts-to-remove/">Ошибка suspiciously many broken parts to remove</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Minikube</title>
            <link>https://weirdvic.github.io/mycelium/minikube/</link>
            <pubDate>Tue, 30 May 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/minikube/</guid>
            <description>Один из простых в использовании дистрибутивов Kubernetes.</description>
            <content type="html"><![CDATA[<p>Один из простых в использовании дистрибутивов <a href="/mycelium/kubernetes/">Kubernetes</a>.</p>
]]></content>
        </item>
        
        <item>
            <title>Ansible</title>
            <link>https://weirdvic.github.io/mycelium/ansible/</link>
            <pubDate>Tue, 23 May 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/ansible/</guid>
            <description>Ansible — наиболее популярная в настоящий момент система управления конфигурациями, написана на языке Python.</description>
            <content type="html"><![CDATA[<p><a href="https://www.ansible.com/">Ansible</a> — наиболее популярная в настоящий момент система управления конфигурациями, написана на языке Python.</p>
]]></content>
        </item>
        
        <item>
            <title>Google Cloud Platform</title>
            <link>https://weirdvic.github.io/mycelium/google-cloud-platform/</link>
            <pubDate>Mon, 22 May 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/google-cloud-platform/</guid>
            <description>Google Cloud Platform (GCP) — облачная платформа от Google, наряду с AWS и Azure входит в тройку крупнейших.</description>
            <content type="html"><![CDATA[<p>Google Cloud Platform (GCP) — облачная платформа от Google, наряду с AWS и Azure входит в тройку крупнейших.</p>
]]></content>
        </item>
        
        <item>
            <title>Hugo</title>
            <link>https://weirdvic.github.io/mycelium/hugo/</link>
            <pubDate>Tue, 16 May 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/hugo/</guid>
            <description>Hugo — популярный генератор статических вебсайтов, написанный на Go.</description>
            <content type="html"><![CDATA[<p><a href="https://gohugo.io/">Hugo</a> — популярный генератор статических вебсайтов, написанный на <a href="/mycelium/%D1%8F%D0%B7%D1%8B%D0%BA-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-go/">Go</a>.</p>
]]></content>
        </item>
        
        <item>
            <title>Реверс-прокси</title>
            <link>https://weirdvic.github.io/mycelium/%D1%80%D0%B5%D0%B2%D0%B5%D1%80%D1%81-%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8/</link>
            <pubDate>Tue, 16 May 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D1%80%D0%B5%D0%B2%D0%B5%D1%80%D1%81-%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8/</guid>
            <description>Тип прокси сервера, который транслирует запросы клиентов из внешней сети на серверы, расположенные во внутренней сети.
Реверс-прокси используется во многих случаях:
Обратный прокси-сервер может скрывать существование опрашиваемых им серверов и их характеристики. Применение программного файрвола в обратном прокси-сервере может защитить от наиболее распространенных веб-атак, таких как DoS или DDoS. Без обратного прокси-сервера удаление вредоносного ПО может оказаться непростой задачей. Основной веб-сайт может не поддерживать подключение по SSL, однако это можно реализовать с помощью обратного прокси-сервера, который может быть оборудован аппаратным SSL-ускорителем.</description>
            <content type="html"><![CDATA[<p>Тип прокси сервера, который транслирует запросы клиентов из внешней сети на серверы, расположенные во внутренней сети.</p>
<p>Реверс-прокси используется во многих случаях:</p>
<ul>
<li>Обратный прокси-сервер может скрывать существование опрашиваемых им серверов и их характеристики.</li>
<li>Применение программного файрвола в обратном прокси-сервере может защитить от наиболее распространенных веб-атак, таких как DoS или DDoS. Без обратного прокси-сервера удаление вредоносного ПО может оказаться непростой задачей.</li>
<li>Основной веб-сайт может не поддерживать подключение по SSL, однако это можно реализовать с помощью обратного прокси-сервера, который может быть оборудован аппаратным SSL-ускорителем.</li>
<li>Выполнение функций балансировщика нагрузки между несколькими серверами, подменяя URL таким образом, чтобы использовался наиболее уместный сервер.</li>
<li>Уменьшение нагрузки на основные сервера благодаря кэшированию статического и динамического контента. Эта возможность известна как акселерация веб-сайтов. Сервер может отсортировать свой кэш по частоте запросов к контенту, что значительно уменьшит нагрузку на основные серверы.</li>
<li>Сжатие содержимого для уменьшения времени его загрузки.</li>
<li>В методе, называемом «spoon feeding», страницы, генерируемые динамически, могут быть отданы обратному прокси-серверу для освобождения ресурсов сервера-генератора от затрат на их отдачу медлительным клиентам.</li>
<li>Может выполнять тестирование, например, A/B-тестирование, изменяя код страниц. Полученные данные можно использовать для последующей оптимизации.</li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Язык программирования Go</title>
            <link>https://weirdvic.github.io/mycelium/%D1%8F%D0%B7%D1%8B%D0%BA-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-go/</link>
            <pubDate>Tue, 16 May 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/%D1%8F%D0%B7%D1%8B%D0%BA-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-go/</guid>
            <description>Go — компилируемый многопоточный язык программирования, изначально разработанный Google.
На Go написано множество полезных инструментов, особенно в области DevOps:
Docker Kubernetes Terraform Hugo </description>
            <content type="html"><![CDATA[<p><a href="https://go.dev/">Go</a> — компилируемый многопоточный язык программирования, изначально разработанный Google.</p>
<p>На Go написано множество полезных инструментов, особенно в области <a href="/mycelium/devops/">DevOps</a>:</p>
<ul>
<li><a href="/mycelium/docker/">Docker</a></li>
<li><a href="/mycelium/kubernetes/">Kubernetes</a></li>
<li><a href="/mycelium/terraform/">Terraform</a></li>
<li><a href="/mycelium/hugo/">Hugo</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Cloudflare</title>
            <link>https://weirdvic.github.io/mycelium/cloudflare/</link>
            <pubDate>Mon, 15 May 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/cloudflare/</guid>
            <description>Cloudflare — сервис, предоставляющий услуги защиты от DDoS, CDN и множество других сервисов.</description>
            <content type="html"><![CDATA[<p>Cloudflare — сервис, предоставляющий услуги защиты от DDoS, CDN и множество других сервисов.</p>
]]></content>
        </item>
        
        <item>
            <title>Docker</title>
            <link>https://weirdvic.github.io/mycelium/docker/</link>
            <pubDate>Mon, 15 May 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/docker/</guid>
            <description>Docker — платформа для управления контейнеризованными приложениями.</description>
            <content type="html"><![CDATA[<p><a href="https://www.docker.com/">Docker</a> — платформа для управления контейнеризованными приложениями.</p>
]]></content>
        </item>
        
        <item>
            <title>Nginx</title>
            <link>https://weirdvic.github.io/mycelium/nginx/</link>
            <pubDate>Mon, 15 May 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/nginx/</guid>
            <description>Nginx — популярный HTTP-сервер, реверс-прокси, почтовый прокси, а также TCP/UDP прокси общего назначения.
Полезные советы по настройке:
Удаление www из URL Запрет доступа по IP адресу </description>
            <content type="html"><![CDATA[<p><a href="https://nginx.org/">Nginx</a> — популярный HTTP-сервер, <a href="/mycelium/%D1%80%D0%B5%D0%B2%D0%B5%D1%80%D1%81-%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8/">реверс-прокси</a>, почтовый прокси, а также TCP/UDP прокси общего назначения.</p>
<p>Полезные советы по настройке:</p>
<ul>
<li><a href="/mycelium/%D1%83%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-www-%D0%B8%D0%B7-url/">Удаление www из URL</a></li>
<li><a href="/mycelium/%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D0%BF%D0%BE-ip-%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D1%83/">Запрет доступа по IP адресу</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Oracle Linux</title>
            <link>https://weirdvic.github.io/mycelium/oracle-linux/</link>
            <pubDate>Mon, 15 May 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/oracle-linux/</guid>
            <description>Дистрибутив Linux на базе RHEL, разрабатываемый Oracle.</description>
            <content type="html"><![CDATA[<p>Дистрибутив Linux на базе RHEL, разрабатываемый Oracle.</p>
]]></content>
        </item>
        
        <item>
            <title>Podman</title>
            <link>https://weirdvic.github.io/mycelium/podman/</link>
            <pubDate>Mon, 15 May 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/podman/</guid>
            <description>Podman — утилита для управления контейнерами, альтернатива Docker.
После установки на Oracle Linux для скачивания контейнеров с DockerHub необходимо залогиниться:
podman login docker.io По-умолчанию в rootless режиме Podman не умеет цепляться к портам ниже 1024, документация по этому поводу предлагает несколько вариантов решения этой проблемы кроме запуска Podman от рута:
В sysctl установить значение net.ipv4.ip_unprivileged_port_start равное минимальному порту, который требуется открывать от непривиллегированного пользователя. То есть если нужно прослушивать 80 порт, это значение должно быть не больше 80.</description>
            <content type="html"><![CDATA[<p><a href="https://podman.io/">Podman</a> — утилита для управления контейнерами, альтернатива <a href="/mycelium/docker/">Docker</a>.</p>
<p>После установки на <a href="/mycelium/oracle-linux/">Oracle Linux</a> для скачивания контейнеров с DockerHub необходимо залогиниться:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>podman login docker.io
</span></span></code></pre></div><p>По-умолчанию в rootless режиме Podman не умеет цепляться к портам ниже 1024, <a href="https://github.com/containers/podman/blob/main/rootless.md">документация</a> по этому поводу предлагает несколько вариантов решения этой проблемы кроме запуска Podman от рута:</p>
<ul>
<li>В sysctl установить значение <code>net.ipv4.ip_unprivileged_port_start</code> равное минимальному порту, который требуется открывать от непривиллегированного пользователя. То есть если нужно прослушивать 80 порт, это значение должно быть не больше 80.</li>
<li>Использовать прокси, правило для фаерволла или специализированные инструменты для редиректа трафика с разрешённого порта на системный.</li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Uptime Kuma</title>
            <link>https://weirdvic.github.io/mycelium/uptime-kuma/</link>
            <pubDate>Mon, 15 May 2023 00:00:00 +0300</pubDate>
            
            <guid>https://weirdvic.github.io/mycelium/uptime-kuma/</guid>
            <description>Uptime Kuma — selfhosted сервис для мониторинга статуса сервисов.
Запуск в podman:
podman volume create uptime-kuma podman run --detach --restart=always -p 127.0.0.1:3001:3001 -v uptime-kuma:/app/data --name uptime-kuma docker.io/louislam/uptime-kuma:1 [2023-05-15 Пн] Запустил внутри podman на сервере xorn в Oracle Cloud. Для доступа снаружи привязал домен trapperkobold.tk в Cloudflare. Для Uptime Kuma зарегистрировал отдельный субдомен uk.trapperkobold.tk и настроил реверс-прокси Nginx. По-умолчанию Nginx в Oracle Linux из-за настроек SELinux не умеет цепляться к локальным портам, это можно исправить командой:</description>
            <content type="html"><![CDATA[<p><a href="https://github.com/louislam/uptime-kuma">Uptime Kuma</a> — selfhosted сервис для мониторинга статуса сервисов.</p>
<p>Запуск в <a href="/mycelium/podman/">podman</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>podman volume create uptime-kuma
</span></span><span style="display:flex;"><span>podman run --detach --restart<span style="color:#f92672">=</span>always -p 127.0.0.1:3001:3001 -v uptime-kuma:/app/data --name uptime-kuma docker.io/louislam/uptime-kuma:1
</span></span></code></pre></div><h2 id="c29f85"><!-- raw HTML omitted --><!-- raw HTML omitted -->[2023-05-15 Пн]<!-- raw HTML omitted --><!-- raw HTML omitted --></h2>
<p>Запустил внутри <a href="/mycelium/podman/">podman</a> на сервере xorn в Oracle Cloud. Для доступа снаружи привязал домен trapperkobold.tk в <a href="/mycelium/cloudflare/">Cloudflare</a>. Для Uptime Kuma зарегистрировал отдельный субдомен uk.trapperkobold.tk и настроил реверс-прокси <a href="/mycelium/nginx/">Nginx</a>. По-умолчанию Nginx в <a href="/mycelium/oracle-linux/">Oracle Linux</a> из-за настроек SELinux не умеет цепляться к локальным портам, это можно исправить командой:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>setsebool httpd_can_network_connect on -P
</span></span></code></pre></div>]]></content>
        </item>
        
    </channel>
</rss>
